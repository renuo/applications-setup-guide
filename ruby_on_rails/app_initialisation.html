<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Initialise the Rails App - Renuo - Application Setup Guide</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Renuo - Application Setup Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="initialise-the-rails-application"><a class="header" href="#initialise-the-rails-application">Initialise the Rails Application</a></h1>
<h2 id="default-rails-setup"><a class="header" href="#default-rails-setup">Default Rails setup</a></h2>
<ul>
<li>
<p>Ensure that your asdf plugins are up to date with <code>asdf plugin update --all</code>.</p>
</li>
<li>
<p>Install the latest Ruby version with <code>asdf install ruby latest</code> (Check if it's <a href="https://devcenter.heroku.com/articles/ruby-support#ruby-versions">supported by Heroku</a>).</p>
</li>
<li>
<p>Switch your global Ruby to the fresh one: <code>asdf global ruby latest</code>.</p>
</li>
<li>
<p>Run <code>gem update --system</code> to update Ruby's default gems (e.g. <code>bundler</code>).</p>
</li>
<li>
<p><a href="http://rubyonrails.org/">Check if you are using the latest stable version of Rails</a> with <code>rails -v</code> and update it if you are not.
You can do this with <code>gem update rails</code>. Beware of beta versions.</p>
</li>
<li>
<p>Start a new Rails project using</p>
</li>
</ul>
<pre><code>rails new [project-name] --database=postgresql --skip-kamal --skip-ci --skip-action-mailbox --template https://raw.githubusercontent.com/renuo/applications-setup-guide/main/ruby_on_rails/template.rb
</code></pre>
<p>where the <code>project-name</code> is exactly the one you chose before.</p>
<blockquote>
<p>⚠️ You may want to choose a different database than Postgres, but most of the time this will be your choice.<br />
If you do not need a DB you may rethink the fact that you may not need Rails at all: Take a look at <a href="http://www.sinatrarb.com/">Sinatra</a> or <a href="https://angular.io/">Angular</a><br />
You might also need actionmailbox of course, so always double-check the parameters that you are using.</p>
</blockquote>
<blockquote>
<p>⭐️ This setup does not include either js-bundling nor css-bundling by default.<br />
It will start with the simplest possible Rails setup and will use sprockets and importmaps.<br />
If you need to do fancy stuff, discuss with your team the opportunity of including a js-bundling and css-bundling tool.<br />
We want to go <a href="https://www.youtube.com/watch?v=iqXjGiQ_D-A">"no build"</a> whenever possible.</p>
</blockquote>
<ul>
<li>
<p>Run <code>bin/setup</code></p>
</li>
<li>
<p>Run <code>bundle exec rails db:migrate</code> to generate an empty <code>schema.rb</code> file.</p>
</li>
<li>
<p>Then check your default Rails setup by running <code>rails s</code> and visiting http://localhost:3000.
You should be on Rails now, yay!</p>
</li>
<li>
<p>Finally check if http://localhost:3000/up is green.</p>
</li>
</ul>
<h2 id="adjustments"><a class="header" href="#adjustments">Adjustments</a></h2>
<p>Some adjustments are made automatically by the template, but you should check them.
Some other adjustments must be performed manually.</p>
<h3 id="automatic-adjustments"><a class="header" href="#automatic-adjustments">Automatic adjustments</a></h3>
<blockquote>
<p>⭐The Gemfile reads the required ruby version from the <code>.ruby-version</code> file.
<a href="https://devcenter.heroku.com/articles/ruby-versions">This is used by Heroku to determine what version to use.</a>
Deploio reads the ruby version from the Gemfile, with the .ruby-version file inlined into it. https://paketo.io/docs/howto/ruby/#override-the-detected-ruby-version</p>
</blockquote>
<blockquote>
<p>⭐️renuocop replaces the default rubocop-rails-omakase. We have our own set of rules at Renuo.
You can discuss them at https://github.com/renuo/renuocop and you can also contribute to them.</p>
</blockquote>
<blockquote>
<p>⭐️a bin/check script is added to the project. This script will run all the tests of the project.
It is used in our CI and can be used locally to check if everything is fine. You can customize it to your needs.</p>
</blockquote>
<blockquote>
<p>⭐️a bin/fastcheck script is added to the project.
This script will run all the linters of the project. It is used in our CI and can be customized to your needs.
It will be used as a hook before pushing to quickly check for linting issues.</p>
</blockquote>
<blockquote>
<p>⭐️a bin/run script is added to the project. This script will start the application.</p>
</blockquote>
<blockquote>
<p>⭐️bin/check, bin/fastcheck and bin/run are standardized tools for more convenience at Renuo.</p>
</blockquote>
<h3 id="manual-adjustments"><a class="header" href="#manual-adjustments">Manual adjustments</a></h3>
<p>Please perform these adjustments manually:</p>
<h4 id="env-variables"><a class="header" href="#env-variables">ENV variables</a></h4>
<ul>
<li>
<p>Add <code>dotenv-rails</code> to Gemfile. Check the <a href="https://github.com/bkeepers/dotenv">gem homepage</a> to see how to install the gem.</p>
</li>
<li>
<p>and create <code>.env.example</code> in the root folder of the project where you will specify the only environment variable you need for now:
<code>SECRET_KEY_BASE</code>.</p>
</li>
<li>
<p>Going forward we will only push the <code>.env.example</code> file to the repository in order to protect our env variables.</p>
</li>
<li>
<p>Add .env to .gitignore</p>
</li>
<li>
<p>Add the following section to your <code>bin/setup</code> script so that the <code>.env</code> is created from the <code>.env</code> when the project is setup locally:</p>
<pre><code class="language-ruby">puts "\n== Copying sample files =="
unless File.exist?('.env')
  system! 'cp .env.example .env'
end
</code></pre>
</li>
<li>
<p>add one more key to .env.example <code>APP_PORT=3000</code></p>
</li>
<li>
<p>To ensure you have all the required keys from the <code>.env.example</code> in your <code>.env</code>,
create the initializer for dotenv-rails in <code>config/initializers/dotenv_rails.rb</code>:</p>
</li>
</ul>
<pre><code class="language-ruby">Dotenv.require_keys(Dotenv.parse(".env.example").keys)
</code></pre>
<ul>
<li>Run <code>bin/setup</code> again.</li>
</ul>
<h3 id="secrets"><a class="header" href="#secrets">Secrets</a></h3>
<p>We store the secrets necessary to configure the project locally in a 1password Item.
Create a new Item for the project called <code>[project-name] project secrets</code> of type note.
Right click on the vault and select <code>Copy Private link</code>.</p>
<ul>
<li>Run the command <code>renuo fetch-secrets --init [the vault private link]</code> to create an empty secrets file.</li>
</ul>
<p>The Item contains the fields that represent the ENV variables. You can use Text or Password fields.
Check existing projects for an example of the usage.</p>
<h4 id="configuration-customisation"><a class="header" href="#configuration-customisation">Configuration customisation</a></h4>
<ul>
<li>
<p>Update <code>config/application.rb</code> and set the default language and timezone</p>
<pre><code class="language-ruby">config.time_zone = 'Zurich' # may vary
config.i18n.default_locale = :de # may vary
</code></pre>
</li>
<li>
<p>Update your <code>config/environments/production.rb</code> settings:</p>
<pre><code class="language-ruby">config.force_ssl = true # uncomment
config.log_level = ENV.fetch("RAILS_LOG_LEVEL", "warn") # change
</code></pre>
</li>
<li>
<p>Update <code>config/environments/development.rb</code> settings:</p>
<pre><code class="language-ruby">config.action_controller.action_on_unpermitted_parameters = :raise
config.i18n.raise_on_missing_translations = true # uncomment

config.generators do |g|
  g.apply_rubocop_autocorrect_after_generate!
end
</code></pre>
</li>
<li>
<p>Update <code>config/environments/test.rb</code> settings:</p>
<pre><code class="language-ruby">config.action_controller.action_on_unpermitted_parameters = :raise
config.i18n.raise_on_missing_translations = true # uncomment
config.i18n.exception_handler = Proc.new { |exception| raise exception.to_exception } # add
config.active_record.verbose_query_logs = true # add

# add the following lines to the end of the file
config.to_prepare do
  ActiveSupport.on_load(:active_record) do
    ActiveRecord::ConnectionAdapters::PostgreSQLAdapter.create_unlogged_tables = true
  end
end
</code></pre>
</li>
<li>
<p>The default <a href="https://github.com/renuo/applications-setup-guide/blob/master/ruby_on_rails/content_security_policy.md">Content Security Policies</a> should not always be activated, but rather only where there are platform secrets that need to be secured. This rule can be overwritten by a customer, if he opted into CSP when selecting his maintenance plans.</p>
</li>
<li>
<p>If you're using a js-bundling tool, let's clean up after asset precompilation
to reduce the size of your deployment. Although deplo.io doesn't have Heroku slugs, it is still good to set up. Add this to the <code>Rakefile</code>:</p>
<pre><code class="language-ruby">Rake::Task['assets:clean'].enhance do
  FileUtils.remove_dir('node_modules', true)
  FileUtils.remove_dir('vendor/javascript', true)
end
</code></pre>
</li>
</ul>
<h2 id="finalising"><a class="header" href="#finalising">Finalising</a></h2>
<ul>
<li>Check if the following scripts run successfully: <code>bin/setup</code>, <code>bin/check</code>, <code>bin/run</code></li>
<li>If they do, commit all your changes to the main branch with Git.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../ruby_on_rails/README.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../ruby_on_rails/first_git_push.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../ruby_on_rails/README.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../ruby_on_rails/first_git_push.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
