#!/bin/sh

if ! bundle exec rubocop -D -c .rubocop.yml --fail-fast
then
  echo 'rubocop detected issues!'
  bundle exec rubocop -a -D -c .rubocop.yml
  echo 'Tried to auto correct the issues, but must be reviewed manually, commit aborted'
  exit 1
fi

if ! bundle exec brakeman -q -z --no-summary --no-pager
then
  echo 'Brakeman has detected one or more security vulnerabilities, please review them and re-commit your changes, commit aborted'
  exit 1
fi

if ! bundle exec mdl ./
then
  echo 'Violated markdown rules, see https://github.com/mivok/markdownlint/blob/master/docs/RULES.md, commit aborted'
  exit 1
fi

if ! bundle exec reek .
then
  echo 'reek detected code smells, commit aborted'
  exit 1
fi

if ! bundle exec scss-lint `find app/assets/stylesheets/ -name "*.scss"`
then
  echo 'scss-lint detected issues, commit aborted'
  exit 1
fi

if ! bundle exec slim-lint app/views/ -c .slim-lint.yml
then
  echo 'slim-lint detected issues, commit aborted'
  exit 1
fi
